<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>d3.js sandbox</title>
    <script src="d3.min.js"></script>
    <script src="../../../Others'/d3/d3.js"></script>
    <script src="fermata.min.js"></script>
    
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0">
    <style>
        html { height: 100%; }
        sdadsfbody { min-height: 2560000px; }
        button { display: block; }
        .dailyGroup { display: inline; border: 2px dotted red; }
        .dailyGroup.cycle { border: 2px dotted blue; }
        .grouped .dailyGroup { display: block; clear: both; }
        .frame { display: inline-block; width: 60px; height: 60px; border: 1px dashed grey; margin: 4px; }
    </style>
</head>
<body>
    <button onClick="document.body.classList.toggle('grouped');">Toggle</button>
    <script>
        var photoDB = fermata.api({url:"http://localhost:5984"})('photos');
        var photosIndexed = photoDB(['_design/shutterstem', '_view']);
        photosIndexed('by_date')({group_level:3}).get(function (e,d) {
            var dailySections = d3.select(document.body).selectAll('section.dailyGroup').data(d.rows.slice(0,100));
            dailySections.enter().append('section').classed('dailyGroup', true).classed('cycle', function (d,i) { return i % 2; })
                .each(function (d) {
                    var dailySection = d3.select(this);
                    for (var i = 0; i < d.value; i += 1) {
                        dailySection.append('div').classed('frame', true);
                    }
                });
        });
        
        function findMaxHeight() {
            function test(height) {
                document.body.style.height = height + "px";
                return document.body.offsetHeight == height;
            }
            var currentHeight = 1;
            while (true) {
                if (test(currentHeight)) {
                    currentHeight *= 2;
                } else {
                    break;
                }
            }
            var minHeight = currentHeight / 2, maxHeight = currentHeight;
            while (true) {
                currentHeight = (minHeight + maxHeight) / 2;
                if (test(currentHeight)) {
                    minHeight = currentHeight;
                } else {
                    maxHeight = currentHeight;
                }
                if (maxHeight - minHeight < 2) {
                    break;
                }
            }
            return currentHeight;
        }
        
        
    </script>
</body>
</html>
